#!/bin/sh

ACTION=$1

if [ -z $ACTION ]; then
	echo Usage: $0 action
	echo
	echo Available actions:
	echo
	echo theme - recompile the theme from sass files
	echo deploy - compile a new deployable version of the app
	echo
	exit
fi

PWD=$(pwd)
SENCHA=$PWD/../SenchaCmd/sencha


if [ "$ACTION" = "theme" ]; then
	cd public/packages/spelled-theme
	$SENCHA package build
	cd $PWD

elif [ "$ACTION" = "deploy" ]; then
	# cleaning up and creating directory tree
        rm -rf build
        mkdir build

        # populating output with static content
        cp -R public/css public/images build
        cp -RL public/libs build
        cp ../../node_modules/requirejs/require.js build/libs
        cp ../../node_modules/underscore/underscore.js build/libs
        cp -R ../ace/lib/ace build/libs

        # creating the javascript include
        $SENCHA -debug compile -classpath=../extjs/src,public/app \
page -yui -in=public/index.html -out=build/index.html

fi
