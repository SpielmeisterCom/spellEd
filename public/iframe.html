<!DOCTYPE HTML>
<html>
<head>
    <title>The IFRAME</title>
</head>
<script type="text/javascript">

    function getParam( name ) {
      name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
      var regexS = "[\\?&]"+name+"=([^&#]*)";
      var regex = new RegExp( regexS );
      var results = regex.exec( window.location.href );
      if( results == null )
        return "";
      else
        return results[1];
    }

    function receiveMessage( event ) {

        if (event.origin !== location.href){
            console.log( "WRONG consumer origin!")
            //return;
        }

        if( event.data.type === "setConfiguration" ) {

            document.body.appendChild(
                document.createTextNode( JSON.stringify(
                        event.data.data
                    )
                )
            )

        }
    }

    window.addEventListener("message", receiveMessage, false);
</script>
<body>
    <canvas id="myCanvas" width="200" height="100"></canvas>
    <script type="text/javascript">
        var c=document.getElementById("myCanvas");
        var ctx=c.getContext("2d");
        ctx.fillStyle="#FF0000";
        ctx.fillRect(0,0,150,75);

        parent.window.postMessage( {
                action: "getConfiguration",
                extId: getParam('id')
            },
            location.href
        )
    </script>
</body>
</html>