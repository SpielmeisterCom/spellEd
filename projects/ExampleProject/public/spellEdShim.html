<!DOCTYPE html>
<html>
	<head>
		<title>Spell Development Build</title>
		<script type="text/javascript" src="output/html5/spell.js"></script>
		<script type="text/javascript" src="output/html5/data.js"></script>
	</head>

	<body>
		<div id="spell"></div>
		<script type="text/javascript">
			var editorOrigin = 'http://localhost:3000'

			function getParam( name ) {
				name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
				var regexS = '[\\?&]'+name+'=([^&#]*)';
				var regex = new RegExp( regexS );
				var results = regex.exec( window.location.href );
				if( results == null )
					return '';
				else
					return results[1];
			}

			function receiveMessage( event ) {
				if( event.origin !== editorOrigin ) {
					console.log( 'event.origin: ' + event.origin )
					console.log( 'Error: origin does not match.' )

					return
				}

				if( event.data.type === 'run' ) {
					spell.start()
				}
			}

			window.addEventListener( 'message', receiveMessage, false )

			parent.window.postMessage(
				{
					action: 'initialized',
					extId: getParam( 'id' )
				},
				editorOrigin
			)
		</script>
	</body>
</html>
